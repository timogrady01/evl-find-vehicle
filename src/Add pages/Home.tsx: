
import { useEffect, useState } from "react";
import { fetchMakes, fetchModels, fetchTrims } from "../services/carApi";

export default function Home() {
  const [makes, setMakes] = useState([]);
  const [models, setModels] = useState([]);
  const [trims, setTrims] = useState([]);
  const [filteredTrims, setFilteredTrims] = useState([]);
  const [selectedTrim, setSelectedTrim] = useState<any>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [trimSearch, setTrimSearch] = useState("");
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 6;

  useEffect(() => {
    loadMakes();
  }, []);

  const loadMakes = async () => {
    try {
      setLoading(true);
      setError("");
      const data = await fetchMakes();
      setMakes(data);
    } catch (err) {
      setError("Failed to load makes. Please try again.");
    } finally {
      setLoading(false);
    }
  };

  const handleMakeChange = async (e: React.ChangeEvent<HTMLSelectElement>) => {
    const makeId = parseInt(e.target.value);
    setModels([]);
    setTrims([]);
    setFilteredTrims([]);
    setSelectedTrim(null);
    try {
      setLoading(true);
      setError("");
      const data = await fetchModels(makeId);
      setModels(data);
    } catch (err) {
      setError("Failed to load models. Please try again.");
    } finally {
      setLoading(false);
    }
  };

  const handleModelChange = async (e: React.ChangeEvent<HTMLSelectElement>) => {
    const modelId = parseInt(e.target.value);
    setTrims([]);
    setFilteredTrims([]);
    setSelectedTrim(null);
    try {
      setLoading(true);
      setError("");
      const data = await fetchTrims(modelId);
      setTrims(data);
      setFilteredTrims(data);
    } catch (err) {
      setError("Failed to load trims. Please try again.");
    } finally {
      setLoading(false);
    }
  };

